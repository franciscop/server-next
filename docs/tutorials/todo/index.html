<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,600|Source+Code+Pro&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="/style.min.css">
  
    <title>Server.js - Tutorials</title>
    <meta name="description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <link rel="icon" type="image/png" href="/img/logo.png"/>
  
    <!-- Twitter -->
    <meta name="twitter:title" content="Server.js - Tutorials" />
    <meta name="twitter:description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://node-server.com/" />
    <meta name="twitter:image" content="https://node-server.com/img/hero.png">
  
    <!-- Facebook & others -->
    <meta property="og:title" content="Server.js - Tutorials" />
    <meta property="og:description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://node-server.com/" />
    <meta property="og:image" content="https://node-server.com/img/hero.png" />
  </head>
  <body>
    <nav>
      <a href="/" class="brand">
        <img class="logo" src="/img/logo.svg" alt="">
        <span>Server.js</span>
      </a>
    
      <input id="bmenub" type="checkbox" class="show">
      <label for="bmenub" class="burger">menu</label>
    
      <div class="menu">
        <a href="/documentation">Documentation</a>
        <a href="/screencasts">Screencasts</a>
        <a href="/tutorials">Tutorials</a>
        <a href="https://github.com/franciscop/server">Github</a>
      </div>
    </nav>
    <main>
      <div class="flex">
        <div class="thirty">
          <aside>
            <div class="scroller">
              <form class="search">
                <input name="search" placeholder="Search Tutorials" />
                <div class="results"></div>
              </form>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/">Getting started</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/#install-node-js">
                          <img src="/img/file.svg" /><span>Install Node.js<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/#create-your-project">
                          <img src="/img/file.svg" /><span>Create your project<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/#initialize-git-and-npm">
                          <img src="/img/file.svg" /><span>Initialize git and npm<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/#build-your-project">
                          <img src="/img/file.svg" /><span>Build your project<span>
                        </a>
                      </div>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/server-production/">Server in production</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/server-production/#set-a-secret">
                          <img src="/img/file.svg" /><span>Set a secret<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/server-production/#session-storage">
                          <img src="/img/file.svg" /><span>Session Storage<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/server-production/#correct-environment">
                          <img src="/img/file.svg" /><span>Correct environment<span>
                        </a>
                      </div>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/spreadsheet/">Spreadsheet database</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/spreadsheet/#create-a-spreadsheet">
                          <img src="/img/file.svg" /><span>Create a spreadsheet<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/spreadsheet/#installation">
                          <img src="/img/file.svg" /><span>Installation<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/spreadsheet/#back-end-with-server-js">
                          <img src="/img/file.svg" /><span>Back-end with server.js<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/spreadsheet/#front-end">
                          <img src="/img/file.svg" /><span>Front-end<span>
                        </a>
                      </div>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/todo/">Todo</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/todo/#install-dependencies">
                          <img src="/img/file.svg" /><span>Install dependencies<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#code-organization">
                          <img src="/img/file.svg" /><span>Code organization<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#rest-api">
                          <img src="/img/file.svg" /><span>REST API<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#database">
                          <img src="/img/file.svg" /><span>Database<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#todos-logic">
                          <img src="/img/file.svg" /><span>Todos logic<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#testing">
                          <img src="/img/file.svg" /><span>Testing<span>
                        </a>
                      </div>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/chat/">Real-time Chat</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/chat/#user-interface">
                          <img src="/img/file.svg" /><span>User Interface<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#choose-a-username">
                          <img src="/img/file.svg" /><span>Choose a username<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#sending-messages">
                          <img src="/img/file.svg" /><span>Sending messages<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#server-handling">
                          <img src="/img/file.svg" /><span>Server handling<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#user-x-joined">
                          <img src="/img/file.svg" /><span>User X joined<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#upload-to-heroku">
                          <img src="/img/file.svg" /><span>Upload to Heroku<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#xss-protection">
                          <img src="/img/file.svg" /><span>XSS Protection<span>
                        </a>
                      </div>
                  </div>
                </section>
            </div>
          </aside>
        </div>
        <div class="seventy">
          <article>
            <div>
  <strong>
    <a class="button source" href="https://github.com/franciscop/server-tutorial-todo">Source code</a>
  </strong>
</div>


    <h1 id="to-do-list">
      TO-DO list
    </h1>
  <p>In this tutorial you will learn to design a basic API to create a list of items. We store them in a MongoDB database using Mongoose and it will be for a single person.</p>
<p>Some possible uses:</p>
<ul>
<li>An actual TO-DO list. Some times you just need a simple list.</li>
<li>The beginning of Hacker News, Reddit, or similar. Those are basically four glorified CRUDs: users, stories, comments, votes.</li>
</ul>
<p>End product:</p>
<p><img src="img/todo_screenshot.png" alt="Screenshot of the final project"></p>

    <h2 id="install-dependencies">
      Install dependencies
    </h2>
  <p>After <a href="/tutorials/getting-started">getting your project ready</a> you&#39;ll have to make sure that you have MongoDB installed following <a href="https://docs.mongodb.com/manual/administration/install-community/">the official guide</a> and run it (will depend on your installation process). To check that you have it on Ubuntu do:</p>
<pre><code class="language-bash">mongod --version   # Should display a number
mongod</code></pre>
<p>Then we install the two libraries that we will be using <strong>within our project folder</strong>:</p>
<pre><code class="language-bash">npm install server mongoose jest</code></pre>

    <h2 id="code-organization">
      Code organization
    </h2>
  <p>Since this is a fairly small project focused on the back-end we will have all our server files within the root folder and won&#39;t go into detail for the front-end. The project will have these files:</p>
<ul>
<li><strong>public/</strong>: the folder for public assets.</li>
<li><strong>views/</strong>: the folder for the only view.</li>
<li><strong>index.js</strong>: the entry point and routers.</li>
<li><strong>model.js</strong>: the definition of the database structure.</li>
<li><strong>package.json</strong>: npm package where the dependencies and some info is.</li>
<li><strong>test.js</strong>: integration tests to make sure everything is working.</li>
<li><strong>todo.js</strong>: interaction with the database and main logic.</li>
</ul>
<p>You can see the whole working project in the repository:</p>
<strong>
  <a href="https://github.com/franciscop/server-tutorial-todo" class="button">
    Github Repository
  </a>
</strong>




    <h2 id="rest-api">
      REST API
    </h2>
  <p>Let&#39;s first of all define our API. Let&#39;s keep it simple! Within index.js we write:</p>
<pre><code class="language-js">// index.js
const server = require(&#39;server&#39;);
const { get, post, put, del } = server.router;
const { render } = server.reply;
const todo = require(&#39;./todo.js&#39;);

// Render the homepage for `/`
const home = get(&#39;/&#39;, ctx =&gt; render(&#39;index.hbs&#39;));

// Add some API endpoints
const api = [
  get(&#39;/todo&#39;, todo.read),
  post(&#39;/todo&#39;, todo.create),
  put(&#39;/todo/:id&#39;, todo.update),
  del(&#39;/todo/:id&#39;, todo.delete)
];

// Launch the server with those
server(home, api);</code></pre>
<p>This first loads the needed library and functions, then defines few routes and finally launches the server with those routes. We are using the default settings so no options are needed.</p>
<p>We are using the <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD operation names</a>, but any of those is fairly common for the method names (just keep them consistent):</p>
<ul>
<li>get(): read, retrieve, all, list, select</li>
<li>post(): create, add, insert</li>
<li>put(): edit, update, change, modify</li>
<li>del(): delete, remove, destroy</li>
</ul>

    <h2 id="database">
      Database
    </h2>
  <p>We are using Mongoose (a layer on top of MongoDB) to implement database access. For this, we first have to create a small <code>model.js</code> where we define how our schema and model data looks like:</p>
<pre><code class="language-js">// model.js
const mongoose = require(&#39;mongoose&#39;);

// Configure the Mongoose plugin
mongoose.connect(process.env.MONGODB_URI || &#39;mongodb://localhost/todo&#39;);

// define the Todo schema
const TodoSchema = mongoose.Schema({
  text: { type: String, required: true },
  done: { type: Boolean, required: true, default: false },
});

module.exports = mongoose.model(&#39;Todo&#39;, TodoSchema);</code></pre>
<p>This way, all of our TODOs will have two fields, the text and a boolean indicating whether or not it&#39;s done.</p>
<p>The mongoose configuration <code>MONGODB_URI</code> <a href="https://serverjs.io/documentation/options/#environment">comes from the environment</a>.</p>

    <h2 id="todos-logic">
      Todos logic
    </h2>
  <p>Now, to write this code we create the file <code>todo.js</code> with this code:</p>
<pre><code class="language-js">// todo.js
const { json } = require(&#39;server/reply&#39;);
const model = require(&#39;./schema&#39;);

export.read = async ctx =&gt; {};
export.create = async ctx =&gt; {};
export.update = async ctx =&gt; {};
export.delete = async ctx =&gt; {};</code></pre>
<p>These are the 4 basic CRUD operations as shown before. This file will export these asynchronous functions, that will take the context argument <a href="https://serverjs.io/documentation/#middleware">as with any server.js middleware</a> and whatever they return will be used for the response.</p>
<p>Finally, let&#39;s implement the database access logic inside each of these 4 functions:</p>
<pre><code class="language-js">// todo.js
const { status, json } = require(&#39;server/reply&#39;);
const Todo = require(&#39;./model&#39;);

exports.read = async (ctx) =&gt; {
  return Todo.find().sort(&#39;done&#39;).lean().exec();
};

exports.create = async (ctx) =&gt; {
  const item = new Todo({ text: ctx.data.text });
  return status(201).json(await item.save());
};

exports.update = async (ctx) =&gt; {
  const set = { $set: { done: ctx.data.done } };
  await Todo.findByIdAndUpdate(ctx.params.id, set).exec();
  return Todo.find().sort(&#39;done&#39;).lean().exec();
};

exports.delete = async (ctx) =&gt; {
  return Todo.findByIdAndRemove(ctx.params.id).exec();
};</code></pre>

    <h2 id="testing">
      Testing
    </h2>
  <blockquote class="error">This section describes a future API and **it is not available yet**. Now please use more traditional testing method.</blockquote>

<p>We will be using <a href="https://facebook.github.io/jest/">Jest</a> for testing, but you can use any library or framework that you prefer. We have to make a small change in our main <code>index.js</code>: we export the return value from server():</p>
<pre><code class="language-js">// ...
module.exports = server(home, api);</code></pre>
<p>Then we can import it from the integration tests. Let&#39;s create a <code>test.js</code>:</p>
<pre><code class="language-js">// test.js
const run = require(&#39;server/test/run&#39;);
const server = require(&#39;./index.js&#39;);

describe(&#39;Homepage&#39;, () =&gt; {
  it(&#39;renders the homepage&#39;, async () =&gt; {
    const res = await run(server).get(&#39;/&#39;);
    expect(res.status).toBe(200);
    expect(res.body).toMatch(/\&lt;h1\&gt;TODO list&lt;\/h1&gt;/i);
  });
});</code></pre>

          </article>
        </div>
      </div>
    </main>
    <script src="https://unpkg.com/prismjs@1.20.0/prism.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/umbrellajs" charset="utf-8"></script>
    <script src="/documentation/script.js" charset="utf-8"></script>
  </body>
</html>
