<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,600|Source+Code+Pro&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="/style.min.css">
  
    <title>Server.js - Tutorials</title>
    <meta name="description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <link rel="icon" type="image/png" href="/img/logo.png"/>
  
    <!-- Twitter -->
    <meta name="twitter:title" content="Server.js - Tutorials" />
    <meta name="twitter:description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://node-server.com/" />
    <meta name="twitter:image" content="https://node-server.com/img/hero.png">
  
    <!-- Facebook & others -->
    <meta property="og:title" content="Server.js - Tutorials" />
    <meta property="og:description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://node-server.com/" />
    <meta property="og:image" content="https://node-server.com/img/hero.png" />
  </head>
  <body>
    <nav>
      <a href="/" class="brand">
        <img class="logo" src="/img/logo.svg" alt="">
        <span>Server.js</span>
      </a>
    
      <input id="bmenub" type="checkbox" class="show">
      <label for="bmenub" class="burger">menu</label>
    
      <div class="menu">
        <a href="/documentation">Documentation</a>
        <a href="/screencasts">Screencasts</a>
        <a href="/tutorials">Tutorials</a>
        <a href="https://github.com/franciscop/server">Github</a>
      </div>
    </nav>
    <main>
      <div class="flex">
        <div class="thirty">
          <aside>
            <div class="scroller">
              <form class="search">
                <input name="search" placeholder="Search Tutorials" />
                <div class="results"></div>
              </form>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/">Getting started</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/#install-node-js">
                          <img src="/img/file.svg" /><span>Install Node.js<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/#create-your-project">
                          <img src="/img/file.svg" /><span>Create your project<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/#initialize-git-and-npm">
                          <img src="/img/file.svg" /><span>Initialize git and npm<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/#build-your-project">
                          <img src="/img/file.svg" /><span>Build your project<span>
                        </a>
                      </div>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/server-production/">Server in production</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/server-production/#set-a-secret">
                          <img src="/img/file.svg" /><span>Set a secret<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/server-production/#session-storage">
                          <img src="/img/file.svg" /><span>Session Storage<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/server-production/#correct-environment">
                          <img src="/img/file.svg" /><span>Correct environment<span>
                        </a>
                      </div>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/spreadsheet/">Spreadsheet database</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/spreadsheet/#create-a-spreadsheet">
                          <img src="/img/file.svg" /><span>Create a spreadsheet<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/spreadsheet/#installation">
                          <img src="/img/file.svg" /><span>Installation<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/spreadsheet/#back-end-with-server-js">
                          <img src="/img/file.svg" /><span>Back-end with server.js<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/spreadsheet/#front-end">
                          <img src="/img/file.svg" /><span>Front-end<span>
                        </a>
                      </div>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/todo/">Todo</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/todo/#install-dependencies">
                          <img src="/img/file.svg" /><span>Install dependencies<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#code-organization">
                          <img src="/img/file.svg" /><span>Code organization<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#rest-api">
                          <img src="/img/file.svg" /><span>REST API<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#database">
                          <img src="/img/file.svg" /><span>Database<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#todos-logic">
                          <img src="/img/file.svg" /><span>Todos logic<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/todo/#testing">
                          <img src="/img/file.svg" /><span>Testing<span>
                        </a>
                      </div>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/tutorials/chat/">Real-time Chat</a>
                  </h3>
                  <div class="submenu">
                      <div>
                        <a href="/tutorials/chat/#user-interface">
                          <img src="/img/file.svg" /><span>User Interface<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#choose-a-username">
                          <img src="/img/file.svg" /><span>Choose a username<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#sending-messages">
                          <img src="/img/file.svg" /><span>Sending messages<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#server-handling">
                          <img src="/img/file.svg" /><span>Server handling<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#user-x-joined">
                          <img src="/img/file.svg" /><span>User X joined<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#upload-to-heroku">
                          <img src="/img/file.svg" /><span>Upload to Heroku<span>
                        </a>
                      </div>
                      <div>
                        <a href="/tutorials/chat/#xss-protection">
                          <img src="/img/file.svg" /><span>XSS Protection<span>
                        </a>
                      </div>
                  </div>
                </section>
            </div>
          </aside>
        </div>
        <div class="seventy">
          <article>
            
    <h1 id="ready-for-production">
      Ready for production
    </h1>
  <p>Server.js is ready to start developing right away, but to make it ready for production there are three steps that are highly recommended:</p>
<ul>
<li><strong>Set a secret</strong>: for your app to use to make sure data stays private. Used in Cookies, sessions, etc.</li>
<li><strong>Correct environment</strong>: make sure it&#39;s set to <code>&quot;production&quot;</code> on your live server for enhanced performance.</li>
<li><strong>Session storage</strong>: by default there is no persistence between server restarts, since many Node.js hostings use ephemeral filesystems. We highly recommend Redis.</li>
</ul>
<p>This tutorial is using the <a href="/documentation/options/#environment">environment variables</a> extensively.</p>

    <h2 id="set-a-secret">
      Set a secret
    </h2>
  <p>The first thing to change is adding a <a href="https://martinfowler.com/articles/session-secret.html">session secret</a> as an <a href="/documentation/options/#environment">environment variable</a> in <code>.env</code> for your machine:</p>
<pre><code>SECRET=your-random-string-here</code></pre>
<p>This will be used to secure the cookies as well as for other plugins that need a secret. Make it unique, long and random. Then <strong>don&#39;t forget to add a different one for the production server</strong> and other stages in your deploy pipeline if any. Also, exclude the <code>.env</code> file from Git <a href="http://localhost:3000/documentation/options/#environment">as explained here</a>.</p>

    <h2 id="session-storage">
      Session Storage
    </h2>
  <p><strong>By default</strong> <a href="https://github.com/expressjs/session">sessions work in-memory with <em>server</em></a> so they are <a href="https://github.com/expressjs/session/pull/220"><strong>not ready for production</strong></a>:</p>
<pre><code class="language-js">// Simple visit counter for the main page
const counter = get(&#39;/&#39;, ctx =&gt; {
  ctx.session.views = (ctx.session.views || 0) + 1;
  return { views: ctx.session.views };
});

/* test */
await run(counter).alive(async api =&gt; {
  let res = await api.get(&#39;/&#39;);
  expect(res.body.views).toBe(1);
  res = await api.get(&#39;/&#39;);
  expect(res.body.views).toBe(2);
  res = await api.get(&#39;/&#39;);
  expect(res.body.views).toBe(3);
});</code></pre>
<p>This works great for testing; for quick demos and for short sessions, but <strong>all session data will die when the server is restarted</strong> since they are stored in the RAM.</p>
<p>To make them persistent we recommend <a href="https://github.com/expressjs/session#compatible-session-stores">using a compatible session storage</a>. We bundle Redis for Node.js by default, so you just have to install it (*nix systems have it easily available). For example, on Ubuntu:</p>
<pre><code>sudo apt install redis-server</code></pre>
<p>Then edit your <code>.env</code> to include <code>REDIS_URL</code>:</p>
<pre><code>SECRET=your-random-string-here
REDIS_URL=redis://:password@hostname:port/db_number</code></pre>
<blockquote>
<p>Note: for Heroku this variable is created automatically when adding <a href="https://devcenter.heroku.com/articles/heroku-redis">the appropriate add-on</a>. For other hosting companies please consult their documentation.</p>
</blockquote>
<p>Otherwise add your preferred storage to the session through the options:</p>
<pre><code class="language-js">const server = require(&#39;server&#39;);
// Your own file for the config:
const storage = require(&#39;./session-storage.js&#39;);
server({ session: { storage } }, [
  // Routes here
]);</code></pre>
<p>If you need to use express&#39; session, as some libraries might require you to do, you can access it through <code>server.session</code>:</p>
<pre><code class="language-js">const server = require(&#39;server&#39;);

// Mount it on express&#39; session
const MongoStore = require(&#39;connect-mongo&#39;)(server.session);
const store = MongoStore(options);

server(
  { session: { store } }
  ...
);</code></pre>

    <h2 id="correct-environment">
      Correct environment
    </h2>
  <p>Lastly we are going to make sure our production server is set to <code>&quot;production&quot;</code> correctly. Some host</p>

    <h3 id="alternatives">
      Alternatives
    </h3>
  <p>Why not just use cookie-session? <a href="http://stackoverflow.com/a/15745086/938236">Here is an explanation of the alternative</a>, but it boils down to:</p>
<ul>
<li>They are more insecure, since all the session data (including sensitive data) is passed forward and backward from the browser to the server in each request.</li>
<li>If the session data is large then that means adding an unnecessary load to both the server and the browser.</li>
</ul>

          </article>
        </div>
      </div>
    </main>
    <script src="https://unpkg.com/prismjs@1.20.0/prism.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/umbrellajs" charset="utf-8"></script>
    <script src="/documentation/script.js" charset="utf-8"></script>
  </body>
</html>
