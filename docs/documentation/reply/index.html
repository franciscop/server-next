<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,600|Source+Code+Pro&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="/style.min.css">
  
    <title>Server.js - Documentation</title>
    <meta name="description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <link rel="icon" type="image/png" href="/img/logo.png"/>
  
    <!-- Twitter -->
    <meta name="twitter:title" content="Server.js - Documentation" />
    <meta name="twitter:description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://node-server.com/" />
    <meta name="twitter:image" content="https://node-server.com/img/hero.png">
  
    <!-- Facebook & others -->
    <meta property="og:title" content="Server.js - Documentation" />
    <meta property="og:description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://node-server.com/" />
    <meta property="og:image" content="https://node-server.com/img/hero.png" />
  </head>
  <body>
    <nav>
      <a href="/" class="brand">
        <img class="logo" src="/img/logo.svg" alt="">
        <span>Node.js Server</span>
      </a>
    
      <input id="bmenub" type="checkbox" class="show">
      <label for="bmenub" class="burger">menu</label>
    
      <div class="menu">
        <a href="/documentation">Documentation</a>
        <a href="/screencasts">Screencasts</a>
        <a href="/tutorials">Tutorials</a>
        <a href="https://github.com/franciscop/server">Github</a>
      </div>
    </nav>
    <main>
      <div class="flex">
        <div class="thirty">
          <aside>
            <div class="scroller">
              <form class="search">
                <input name="search" placeholder="Search Documentation" />
                <div class="results"></div>
              </form>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/documentation/">Introduction</a>
                  </h3>
                  <div class="submenu">
                      <a href="/documentation/#getting-started">
                        <img src="/img/file.svg" /><span>Getting started<span>
                      </a>
                      <a href="/documentation/#basic-usage">
                        <img src="/img/file.svg" /><span>Basic usage<span>
                      </a>
                      <a href="/documentation/#middleware">
                        <img src="/img/file.svg" /><span>Middleware<span>
                      </a>
                      <a href="/documentation/#express-middleware">
                        <img src="/img/file.svg" /><span>Express middleware<span>
                      </a>
                      <a href="/documentation/#cors">
                        <img src="/img/file.svg" /><span>CORS<span>
                      </a>
                      <a href="/documentation/#routing">
                        <img src="/img/file.svg" /><span>Routing<span>
                      </a>
                      <a href="/documentation/#advanced-topics">
                        <img src="/img/file.svg" /><span>Advanced topics<span>
                      </a>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/documentation/options/">Options</a>
                  </h3>
                  <div class="submenu">
                      <a href="/documentation/options/#port">
                        <img src="/img/file.svg" /><span>Port<span>
                      </a>
                      <a href="/documentation/options/#secret">
                        <img src="/img/file.svg" /><span>Secret<span>
                      </a>
                      <a href="/documentation/options/#public">
                        <img src="/img/file.svg" /><span>Public<span>
                      </a>
                      <a href="/documentation/options/#views">
                        <img src="/img/file.svg" /><span>Views<span>
                      </a>
                      <a href="/documentation/options/#engine">
                        <img src="/img/file.svg" /><span>Engine<span>
                      </a>
                      <a href="/documentation/options/#env">
                        <img src="/img/file.svg" /><span>Env<span>
                      </a>
                      <a href="/documentation/options/#favicon">
                        <img src="/img/file.svg" /><span>Favicon<span>
                      </a>
                      <a href="/documentation/options/#parse">
                        <img src="/img/file.svg" /><span>Parse<span>
                      </a>
                      <a href="/documentation/options/#session">
                        <img src="/img/file.svg" /><span>Session<span>
                      </a>
                      <a href="/documentation/options/#socket">
                        <img src="/img/file.svg" /><span>Socket<span>
                      </a>
                      <a href="/documentation/options/#security">
                        <img src="/img/file.svg" /><span>Security<span>
                      </a>
                      <a href="/documentation/options/#log">
                        <img src="/img/file.svg" /><span>Log<span>
                      </a>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/documentation/context/">Context</a>
                  </h3>
                  <div class="submenu">
                      <a href="/documentation/context/#options">
                        <img src="/img/file.svg" /><span>.options<span>
                      </a>
                      <a href="/documentation/context/#data">
                        <img src="/img/file.svg" /><span>.data<span>
                      </a>
                      <a href="/documentation/context/#params">
                        <img src="/img/file.svg" /><span>.params<span>
                      </a>
                      <a href="/documentation/context/#query">
                        <img src="/img/file.svg" /><span>.query<span>
                      </a>
                      <a href="/documentation/context/#session">
                        <img src="/img/file.svg" /><span>.session<span>
                      </a>
                      <a href="/documentation/context/#headers">
                        <img src="/img/file.svg" /><span>.headers<span>
                      </a>
                      <a href="/documentation/context/#cookies">
                        <img src="/img/file.svg" /><span>.cookies<span>
                      </a>
                      <a href="/documentation/context/#files">
                        <img src="/img/file.svg" /><span>.files<span>
                      </a>
                      <a href="/documentation/context/#ip">
                        <img src="/img/file.svg" /><span>.ip<span>
                      </a>
                      <a href="/documentation/context/#url">
                        <img src="/img/file.svg" /><span>.url<span>
                      </a>
                      <a href="/documentation/context/#method">
                        <img src="/img/file.svg" /><span>.method<span>
                      </a>
                      <a href="/documentation/context/#path">
                        <img src="/img/file.svg" /><span>.path<span>
                      </a>
                      <a href="/documentation/context/#secure">
                        <img src="/img/file.svg" /><span>.secure<span>
                      </a>
                      <a href="/documentation/context/#xhr">
                        <img src="/img/file.svg" /><span>.xhr<span>
                      </a>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/documentation/router/">Router</a>
                  </h3>
                  <div class="submenu">
                      <a href="/documentation/router/#get">
                        <img src="/img/file.svg" /><span>get()<span>
                      </a>
                      <a href="/documentation/router/#post">
                        <img src="/img/file.svg" /><span>post()<span>
                      </a>
                      <a href="/documentation/router/#put">
                        <img src="/img/file.svg" /><span>put()<span>
                      </a>
                      <a href="/documentation/router/#del">
                        <img src="/img/file.svg" /><span>del()<span>
                      </a>
                      <a href="/documentation/router/#error">
                        <img src="/img/file.svg" /><span>error()<span>
                      </a>
                      <a href="/documentation/router/#sub">
                        <img src="/img/file.svg" /><span>sub()<span>
                      </a>
                      <a href="/documentation/router/#socket">
                        <img src="/img/file.svg" /><span>socket()<span>
                      </a>
                  </div>
                </section>
                <section>
                  <h3>
                    <div class="more"><img src="/img/plus.svg" /></div>
                    <a href="/documentation/reply/">Reply</a>
                  </h3>
                  <div class="submenu">
                      <a href="/documentation/reply/#cookie">
                        <img src="/img/file.svg" /><span>cookie()<span>
                      </a>
                      <a href="/documentation/reply/#download">
                        <img src="/img/file.svg" /><span>download()<span>
                      </a>
                      <a href="/documentation/reply/#header">
                        <img src="/img/file.svg" /><span>header()<span>
                      </a>
                      <a href="/documentation/reply/#json">
                        <img src="/img/file.svg" /><span>json()<span>
                      </a>
                      <a href="/documentation/reply/#jsonp">
                        <img src="/img/file.svg" /><span>jsonp()<span>
                      </a>
                      <a href="/documentation/reply/#redirect">
                        <img src="/img/file.svg" /><span>redirect()<span>
                      </a>
                      <a href="/documentation/reply/#render">
                        <img src="/img/file.svg" /><span>render()<span>
                      </a>
                      <a href="/documentation/reply/#send">
                        <img src="/img/file.svg" /><span>send()<span>
                      </a>
                      <a href="/documentation/reply/#status">
                        <img src="/img/file.svg" /><span>status()<span>
                      </a>
                      <a href="/documentation/reply/#type">
                        <img src="/img/file.svg" /><span>type()<span>
                      </a>
                  </div>
                </section>
            </div>
          </aside>
        </div>
        <div class="seventy">
          <article>
            
    <h1 id="reply">
      Reply
    </h1>
  <p>A reply is a method <strong>returned from a middleware</strong> that creates the response. These are the available methods and their parameters for <code>server.reply</code>:</p>
<table>
<thead>
<tr>
<th>reply name</th>
<th>example</th>
<th>final</th>
</tr>
</thead>
<tbody><tr>
<td><a href="#cookie-"><code>cookie(name, value, opts)</code></a></td>
<td>cookie(&#39;name&#39;, &#39;Francisco&#39;)</td>
<td>false</td>
</tr>
<tr>
<td><a href="#download-"><code>download(path[, filename])</code></a></td>
<td>download(&#39;resume.pdf&#39;)</td>
<td>true</td>
</tr>
<tr>
<td><a href="#header-"><code>header(field[, value])</code></a></td>
<td>header(&#39;ETag&#39;: &#39;12345&#39;)</td>
<td>false</td>
</tr>
<tr>
<td><a href="#json-"><code>json([data])</code></a></td>
<td>json({ hello: &#39;world&#39; })</td>
<td>true</td>
</tr>
<tr>
<td><a href="#jsonp-"><code>jsonp([data])</code></a></td>
<td>jsonp({ hello: &#39;world&#39; })</td>
<td>true</td>
</tr>
<tr>
<td><a href="#redirect-"><code>redirect([status,] path)</code></a></td>
<td>redirect(302, &#39;/&#39;)</td>
<td>true</td>
</tr>
<tr>
<td><a href="#render-"><code>render(view[, locals])</code></a></td>
<td>render(&#39;index.hbs&#39;)</td>
<td>true</td>
</tr>
<tr>
<td><a href="#send-"><code>send([body])</code></a></td>
<td>send(&#39;Hello there&#39;)</td>
<td>true</td>
</tr>
<tr>
<td><a href="#status-"><code>status(code)</code></a></td>
<td>status(200)</td>
<td>mixed</td>
</tr>
<tr>
<td><a href="#type-"><code>type(type)</code></a></td>
<td>type(&#39;html&#39;)</td>
<td>false</td>
</tr>
</tbody></table>
<p>Examples:</p>
<pre><code class="language-js">const { get, post } = require(&#39;server/router&#39;);
const { render, redirect, file } = require(&#39;server/reply&#39;);

module.exports = [
  get(&#39;/&#39;, ctx =&gt; render(&#39;index.hbs&#39;)),
  post(&#39;/&#39;, processRequest, ctx =&gt; redirect(&#39;/&#39;))
];</code></pre>
<blockquote class="warning">
  Make sure to **return** the reply that you want to use. It won't work otherwise.
</blockquote>



<p>The <code>ctx</code> argument is <a href="/documentation/context">explained in middleware&#39;s Context</a>. The reply methods can be imported in several ways:</p>
<pre><code class="language-js">// For whenever you have previously defined `server`
const { send, json } = server.reply;

// For standalone files:
const { send, json } = require(&#39;server/reply&#39;);</code></pre>
<p>There are many more ways of importing the reply methods, but those above are the recommended ones.</p>

    <h3 id="chainable">
      Chainable
    </h3>
  <p>While most of the replies are final and they should be invoked only once, there are a handful of others that can be chained. These add something to the ongoing response:</p>
<ul>
<li><a href="#cookie-">cookie()</a>: add cookie headers</li>
<li><a href="#header-">header()</a>: add any headers you want</li>
<li><a href="#status-">status()</a>: set the status of the response</li>
<li><a href="#type-">type()</a>: adds the header &#39;Content-Type&#39;</li>
</ul>
<p>You can chain those among themselves and any of those with a final method that sends. If no final method is called in any place the request will be finished with a 404 response.</p>
<p>The <code>status()</code> reply can be used as final or as chainable if something else is added.</p>

    <h3 id="return-value">
      Return value
    </h3>
  <p>Both in synchronous mode or asyncrhonous mode you can just return a string to create a response:</p>
<pre><code class="language-js">// Send a string
const middle = ctx =&gt; &#39;Hello 世界&#39;;

// Test it
const res = await run(middle).get(&#39;/&#39;);
expect(res.body).toBe(&#39;Hello 世界&#39;);</code></pre>
<p>Returning an array or an object will stringify them as JSON:</p>
<pre><code class="language-js">server(ctx =&gt; [&#39;life&#39;, 42]);
// Note: extra parenthesis needed by the arrow function to return an object
server(ctx =&gt; ({ life: 42 }));</code></pre>
<p>A single number will be interpreted as a status code and the corresponding body for that status will be returned:</p>
<pre><code class="language-js">server(get(&#39;/nonexisting&#39;, =&gt; 404));</code></pre>
<p>You can also throw anything to trigger an error:</p>
<pre><code class="language-js">const middle = ({ req }) =&gt; {
  if (!req.body) {
    throw new Error(&#39;No body provided&#39;);
  }
}

const handler = error(ctx =&gt; ctx.error.message);

// Test it
const res = await run(middle, handler).get(&#39;/nonexisting&#39;);
expect(res.body).toBe(&#39;No body provided&#39;);</code></pre>

    <h3 id="multiple-replies">
      Multiple replies
    </h3>
  <p>Another important thing is that the first reply used is the one that will be used. However, you should try to avoid this and we might make it more strict in the future:</p>
<pre><code class="language-js">// I hope you speak Spanish
server([
  ctx =&gt; &#39;Hola mundo&#39;,
  ctx =&gt; &#39;Hello world&#39;,
  ctx =&gt; &#39;こんにちは、世界&#39;
]);</code></pre>
<p>To avoid this, just specify the url for each request in a <a href="/documentation/router">router</a>:</p>
<pre><code class="language-js">// I hope you speak Spanish
server([
  get(&#39;/es&#39;, ctx =&gt; &#39;Hola mundo&#39;),
  get(&#39;/en&#39;, ctx =&gt; &#39;Hello world&#39;),
  get(&#39;/jp&#39;, ctx =&gt; &#39;こんにちは、世界&#39;)
]);</code></pre>
<p>Then each of those URLs will use a different language.</p>

    <h2 id="cookie">
      cookie()
    </h2>
  <p>Set a cookie on the browser. It will send the Set-Cookie headers:</p>
<pre><code class="language-js">const { cookie } = server.reply;
const setCookie = ctx =&gt; cookie(&#39;foo&#39;, &#39;bar&#39;).send();

// Test
run(setCookie).get(&#39;/&#39;).then(res =&gt; {
  expect(res.headers[&#39;Set-Cookie:&#39;]).toMatch(/foo\=bar/);
});</code></pre>
<table>
<thead>
<tr>
<th>Key</th>
<th>Default</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td><code>domain</code></td>
<td>Current domain</td>
<td>String</td>
</tr>
<tr>
<td><code>encode</code></td>
<td><code>encodeURIComponent</code></td>
<td>Function</td>
</tr>
<tr>
<td><code>expires</code></td>
<td><code>undefined</code> (session)</td>
<td>Date</td>
</tr>
<tr>
<td><code>httpOnly</code></td>
<td><code>false</code></td>
<td>Boolean</td>
</tr>
<tr>
<td><code>maxAge</code></td>
<td><code>undefined</code> (session)</td>
<td>Number</td>
</tr>
<tr>
<td><code>path</code></td>
<td><code>&quot;/&quot;</code></td>
<td>String</td>
</tr>
<tr>
<td><code>secure</code></td>
<td><code>false</code></td>
<td>Boolean</td>
</tr>
<tr>
<td><code>signed</code></td>
<td><code>false</code></td>
<td>Boolean</td>
</tr>
<tr>
<td><code>sameSite</code></td>
<td><code>false</code></td>
<td>Boolean or String</td>
</tr>
</tbody></table>
<p>See a better explanation of each one of those in <a href="https://expressjs.com/en/4x/api.html#res.cookie">express&#39; documentation</a>.</p>

    <h2 id="download">
      download()
    </h2>
  <p>An async function that takes a local path and an optional filename. It will return the local file with the filename name for the browser to download.</p>
<pre><code class="language-js">server(ctx =&gt; download(&#39;user-file-5674354.pdf&#39;));
server(ctx =&gt; download(&#39;user-file-5674354.pdf&#39;, &#39;report.pdf&#39;));</code></pre>
<p>You can handle errors for this method downstream:</p>
<pre><code class="language-js">server([
  ctx =&gt; download(&#39;user-file-5674354.pdf&#39;),
  error(ctx =&gt; { console.log(ctx.error); })
]);</code></pre>

    <h2 id="header">
      header()
    </h2>
  <p>Set a header to be sent with the response. It accepts two strings as key and value or an object to set multiple headers:</p>
<pre><code class="language-js">const mid = ctx =&gt; header(&#39;Content-Type&#39;, &#39;text/plain&#39;);
const mid2 = ctx =&gt; header(&#39;Content-Length&#39;, &#39;123&#39;);

// Same as above
const mid = ctx =&gt; header({
  &#39;Content-Type&#39;: &#39;text/plain&#39;,
  &#39;Content-Length&#39;: &#39;123&#39;
});</code></pre>

    <h2 id="json">
      json()
    </h2>
  <p>Sends a JSON response. It accepts a plain object or an array that will be stringified with <code>JSON.stringify</code>. Sets the correct <code>Content-Type</code> headers as well:</p>
<pre><code class="language-js">const mid = ctx =&gt; json({ foo: &#39;bar&#39; });

// Test it
run(mid).get(&#39;/&#39;).then(res =&gt; {
  expect(res.body).toEqual(`{&quot;foo&quot;:&quot;bar&quot;}`);
});</code></pre>

    <h2 id="jsonp">
      jsonp()
    </h2>
  <p>Same as <a href="#json">json()</a> but wrapped with a callback. <a href="https://en.wikipedia.org/wiki/JSONP">Read more about JSONP</a>:</p>
<pre><code class="language-js">const mid = ctx =&gt; jsonp({ foo: &#39;bar&#39; });

// Test it
run(mid).get(&#39;/?callback=callback&#39;).then(res =&gt; {
  expect(res.body).toMatch(&#39;callback({foo:&quot;bar&quot;})&#39;);
});</code></pre>
<p>It is useful for loading data Cross-Domain. The query <code>?callback=foo</code> <strong>is mandatory</strong> and you should set the callback name there:</p>
<pre><code class="language-js">const mid = ctx =&gt; jsonp({ foo: &#39;bar&#39; });

// Test it
run(mid).get(&#39;/?callback=foo&#39;).then(res =&gt; {
  expect(res.body).toMatch(&#39;foo({foo:&quot;bar&quot;})&#39;);
});</code></pre>

    <h2 id="redirect">
      redirect()
    </h2>
  <p>Redirects to the url specified. It can be either internal (just a path) or an external URL:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; redirect(&#39;/foo&#39;);
const mid2 = ctx =&gt; redirect(&#39;../user&#39;);
const mid3 = ctx =&gt; redirect(&#39;https://google.com&#39;);
const mid4 = ctx =&gt; redirect(301, &#39;https://google.com&#39;);</code></pre>

    <h2 id="render">
      render()
    </h2>
  <p>This is the most complex method and yet the most useful one. It takes a filename and some data and renders it:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; render(&#39;index.hbs&#39;);
const mid2 = ctx =&gt; render(&#39;index.hbs&#39;, { user: &#39;Francisco&#39; });</code></pre>
<p>The filename is relative to the <a href="/documentation/options/#-views-">views option</a>  (defaults to <code>&#39;views&#39;</code>):</p>
<pre><code class="language-js">// Renders PROJECT/somefolder/index.hbs
server({ views: &#39;somefolder&#39; }, ctx =&gt; render(&#39;index.hbs&#39;));</code></pre>
<p>The extension of this filename is optional. It accepts by default <code>.hbs</code>, <code>.pug</code> and <code>.html</code> and can accept more types <a href="/documentation/options/#-engine-">installing other engines</a>:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; render(&#39;index.pug&#39;);
const mid2 = ctx =&gt; render(&#39;index.hbs&#39;);
const mid3 = ctx =&gt; render(&#39;index.html&#39;);</code></pre>
<p>The data will be passed to the template engine. Note that some plugins might pass additional data as well.</p>

    <h2 id="send">
      send()
    </h2>
  <p>Send the data to the front-end. It is the method used by default with <a href="#raw-return">the raw returns</a>:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; send(&#39;Hello 世界&#39;);
const mid2 = ctx =&gt; &#39;Hello 世界&#39;;</code></pre>
<p>However it supports many more data types: String, object, Array or Buffer:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; send(&#39;Hello 世界&#39;);
const mid2 = ctx =&gt; send(&#39;&lt;p&gt;Hello 世界&lt;/p&gt;&#39;);
const mid4 = ctx =&gt; send({ foo: &#39;bar&#39; });
const mid3 = ctx =&gt; send(new Buffer(&#39;whatever&#39;));</code></pre>
<p>It also has the advantage that it can be chained, unlike just returning the string:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; status(201).send({ resource: &#39;foobar&#39; });
const mid2 = ctx =&gt; status(404).send(&#39;Not found&#39;);
const mid3 = ctx =&gt; status(500).send({ error: &#39;our fault&#39; });</code></pre>

    <h2 id="status">
      status()
    </h2>
  <p>Sets the status of the response. If no reply is done, it will become final and send that response message as the body:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; status(404);  // The same as:
const mid2 = ctx =&gt; status(404).send(&#39;Not found&#39;);</code></pre>

    <h2 id="type">
      type()
    </h2>
  <p>Set the <code>Content-Type</code> header for the response. It can be a explicit MIME type like these:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; type(&#39;text/html&#39;).send(&#39;&lt;p&gt;Hello&lt;/p&gt;&#39;);
const mid2 = ctx =&gt; type(&#39;application/json&#39;).send(JSON.stringify({ foo: &#39;bar&#39; }));
const mid3 = ctx =&gt; type(&#39;image/png&#39;).send(...);</code></pre>
<p>Or you can also write their more friendly names for an equivalent result:</p>
<pre><code class="language-js">const mid1 = ctx =&gt; type(&#39;.html&#39;);
const mid2 = ctx =&gt; type(&#39;html&#39;);
const mid3 = ctx =&gt; type(&#39;json&#39;);
const mid4 = ctx =&gt; type(&#39;application/json&#39;);
const mid5 = ctx =&gt; type(&#39;png&#39;);</code></pre>

          </article>
        </div>
      </div>
    </main>
    <script src="https://unpkg.com/prismjs@1.20.0/prism.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/umbrellajs" charset="utf-8"></script>
    <script src="/documentation/script.js" charset="utf-8"></script>
  </body>
</html>
