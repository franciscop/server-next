<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat:400,600|Source+Code+Pro&display=swap"
      rel="stylesheet">
    <link rel="stylesheet" href="/style.min.css">
  
    <title>Server.js - Documentation</title>
    <meta name="description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <link rel="icon" type="image/png" href="/img/logo.png"/>
  
    <!-- Twitter -->
    <meta name="twitter:title" content="Server.js - Documentation" />
    <meta name="twitter:description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://node-server.com/" />
    <meta name="twitter:image" content="https://node-server.com/img/hero.png">
  
    <!-- Facebook & others -->
    <meta property="og:title" content="Server.js - Documentation" />
    <meta property="og:description" content="A library to easily create a modern Node.js server. Handles HTTP, Websockets and all the small details." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://node-server.com/" />
    <meta property="og:image" content="https://node-server.com/img/hero.png" />
  </head>
  <body>
    <nav>
      <a href="/" class="brand">
        <img class="logo" src="/img/logo.svg" alt="">
        <span>Node.js Server</span>
      </a>
    
      <input id="bmenub" type="checkbox" class="show">
      <label for="bmenub" class="burger">menu</label>
    
      <div class="menu">
        <a href="/documentation">Documentation</a>
        <a href="/screencasts">Screencasts</a>
        <a href="/tutorials">Tutorials</a>
        <a href="https://github.com/franciscop/server">Github</a>
      </div>
    </nav>
    <main>
      <div class="flex">
        <div class="thirty">
          <aside>
            <div class="scroller">
                <h3>Introduction</h3>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/#getting-started">Getting started</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/#basic-usage">Basic usage</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/#middleware">Middleware</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/#express-middleware">Express middleware</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/#cors">CORS</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/#routing">Routing</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/#advanced-topics">Advanced topics</a>
                  </div>
                <h3>Options</h3>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#port">Port</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#secret">Secret</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#public">Public</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#views">Views</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#engine">Engine</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#env">Env</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#favicon">Favicon</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#parse">Parse</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#session">Session</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#socket">Socket</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#security">Security</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/options#log">Log</a>
                  </div>
                <h3>Context</h3>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#options">.options</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#data">.data</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#params">.params</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#query">.query</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#session">.session</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#headers">.headers</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#cookies">.cookies</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#files">.files</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#ip">.ip</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#url">.url</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#method">.method</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#path">.path</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#secure">.secure</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/context#xhr">.xhr</a>
                  </div>
                <h3>Router</h3>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#options">.options</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#data">.data</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#params">.params</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#query">.query</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#session">.session</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#headers">.headers</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#cookies">.cookies</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#files">.files</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#ip">.ip</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#url">.url</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#method">.method</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#path">.path</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#secure">.secure</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/router#xhr">.xhr</a>
                  </div>
                <h3>Reply</h3>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#options">.options</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#data">.data</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#params">.params</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#query">.query</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#session">.session</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#headers">.headers</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#cookies">.cookies</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#files">.files</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#ip">.ip</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#url">.url</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#method">.method</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#path">.path</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#secure">.secure</a>
                  </div>
                  <div>
                    <img src="/img/file.svg" /><a href="/documentation/reply#xhr">.xhr</a>
                  </div>
            </div>
          </aside>
        </div>
        <div class="seventy">
          <article>
            
    <h1 id="context">
      Context
    </h1>
  <p>Context is the <strong>only</strong> parameter that middleware receives and contains all the information available at this point of the request:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>example</th>
<th>type</th>
</tr>
</thead>
<tbody><tr>
<td><a href="#-options">.options</a></td>
<td><code>{ port: 3000, public: &#39;public&#39; }</code></td>
<td>Object</td>
</tr>
<tr>
<td><a href="#-data">.data</a></td>
<td><code>{ firstName: &#39;Francisco &#39;}</code></td>
<td>Object</td>
</tr>
<tr>
<td><a href="#-params">.params</a></td>
<td><code>{ id: 42 }</code></td>
<td>Object</td>
</tr>
<tr>
<td><a href="#-query">.query</a></td>
<td><code>{ search: &#39;42&#39; }</code></td>
<td>Object</td>
</tr>
<tr>
<td><a href="#-session">.session</a></td>
<td><code>{ user: { firstName: &#39;Francisco&#39; } }</code></td>
<td>Object</td>
</tr>
<tr>
<td><a href="#-headers">.headers</a></td>
<td><code>{ &#39;Content-Type&#39;: &#39;application/json&#39; }</code></td>
<td>Object</td>
</tr>
<tr>
<td><a href="#-cookies">.cookies</a></td>
<td><code>{ acceptCookieLaw: true }</code></td>
<td>Object</td>
</tr>
<tr>
<td><a href="#-files">.files</a></td>
<td><code>{ profilepic: { ... } }</code></td>
<td>Object</td>
</tr>
<tr>
<td><a href="#-ip">.ip</a></td>
<td><code>&#39;192.168.1.1&#39;</code></td>
<td>String</td>
</tr>
<tr>
<td><a href="#-url">.url</a></td>
<td><code>&#39;/cats/?type=cute&#39;</code></td>
<td>String</td>
</tr>
<tr>
<td><a href="#-method">.method</a></td>
<td><code>&#39;GET&#39;</code></td>
<td>String</td>
</tr>
<tr>
<td><a href="#-path">.path</a></td>
<td><code>&#39;/cats/&#39;</code></td>
<td>String</td>
</tr>
<tr>
<td><a href="#-secure">.secure</a></td>
<td><code>true</code></td>
<td>Boolean</td>
</tr>
<tr>
<td><a href="#-xhr">.xhr</a></td>
<td><code>false</code></td>
<td>Boolean</td>
</tr>
</tbody></table>
<p>It can appear at several points, but the most important one is as a middleware parameter:</p>
<pre><code class="language-js">// Load the server from the dependencies
const server = require(&quot;server&quot;);

// Display &quot;Hello 世界&quot; for any request
const middleware = (ctx) =&gt; {
  // ... (ctx is available here)
  return &quot;Hello 世界&quot;;
};

// Launch the server with a single middleware
server(middleware);</code></pre>

    <h2 id="options">
      .options
    </h2>
  <p>An object containing <a href="/documentation/options/">all of the parsed options</a> used by server.js. It combines environment variables and explicit options from <code>server({ a: &#39;b&#39; });</code>:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.options.port).toBe(3012);
};

/* test */
const res = await run({ port: 3012 }, mid, () =&gt; 200).get(&quot;/&quot;);
expect(res.status).toBe(200);</code></pre>
<p>If we have a variable set in the <code>.env</code> or through some other environment variables, it&#39;ll use that instead as <a href="/documentation/options/">environment options take preference</a>:</p>
<pre><code class="language-bash"># .env
PORT=80</code></pre>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.options.port).toBe(7693);
};

/* test */
const res = await run({ port: 7693 }, mid, () =&gt; 200).get(&quot;/&quot;);
expect(res.status).toBe(200);</code></pre>

    <h2 id="data">
      .data
    </h2>
  <p>This is aliased as <code>body</code> as in other libraries. It is the data sent with the request. It can be part of a POST or PUT request, but it can also be set by others such as websockets:</p>
<pre><code class="language-js">const middle = (ctx) =&gt; {
  expect(ctx.data).toBe(&quot;Hello 世界&quot;);
};

// Test it (csrf set to false for testing purposes)
run(noCsrf, middle).post(&quot;/&quot;, { body: &quot;Hello 世界&quot; });
run(middle).emit(&quot;message&quot;, &quot;Hello 世界&quot;);</code></pre>
<p>To handle forms sent normally:</p>
<pre><code class="language-pug">//- index.pug
form(method=&quot;POST&quot; action=&quot;/contact&quot;)
  input(name=&quot;email&quot;)
  input(name=&quot;_csrf&quot; value=csrf type=&quot;hidden&quot;)
  input(type=&quot;submit&quot; value=&quot;Subscribe&quot;)</code></pre>
<p>Then to parse the data from the back-end:</p>
<pre><code class="language-js">const server = require(&quot;server&quot;);
const { get, post } = server.router;
const { render, redirect } = server.reply;

server([
  get((ctx) =&gt; render(&quot;index.pug&quot;)),
  post((ctx) =&gt; {
    console.log(ctx.data); // Logs the email
    return redirect(&quot;/&quot;);
  }),
]);</code></pre>

    <h2 id="params">
      .params
    </h2>
  <p>Parameters from the URL as specified <a href="/documentation/router/">in the route</a>:</p>
<pre><code class="language-js">const mid = get(&quot;/:type/:id&quot;, (ctx) =&gt; {
  expect(ctx.params.type).toBe(&quot;dog&quot;);
  expect(ctx.params.id).toBe(&quot;42&quot;);
});

// Test it
run(mid).get(&quot;/dog/42&quot;);</code></pre>
<p>They come from parsing <a href="#-path">the <code>ctx.path</code></a> with the <a href="https://www.npmjs.com/package/path-to-regexp">package <code>path-to-regexp</code></a>. Go there to see more information about it.</p>
<pre><code class="language-js">const mid = del(&quot;/user/:id&quot;, (ctx) =&gt; {
  console.log(&quot;Delete user:&quot;, ctx.params.id);
});</code></pre>

    <h2 id="query">
      .query
    </h2>
  <p>The parameters from the query when making a request. These come from the url fragment <code>?answer=42&amp;...</code>:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.query.answer).toBe(&quot;42&quot;);
  expect(ctx.query.name).toBe(&quot;Francisco&quot;);
};

// Test it
run(mid).get(&quot;/question?answer=42&amp;name=Francisco&quot;);</code></pre>

    <h2 id="session">
      .session
    </h2>
  <p>After following the <a href="localhost:3000/tutorials/sessions-production/">sessions in production tutorial</a>, sessions should be ready to get rolling. This is an object that persist among the user refreshing the page and navigation:</p>
<pre><code class="language-js">// Count how many pages the visitor sees
const mid = (ctx) =&gt; {
  ctx.session.counter = (ctx.session.counter || 0) + 1;
  return ctx.session.counter;
};

// Test that it works
run(ctx).alive(async (ctx) =&gt; {
  await api.get(&quot;/&quot;);
  await api.get(&quot;/&quot;);
  const res = await api.get(&quot;/&quot;);
  expect(res.body).toBe(&quot;3&quot;);
});</code></pre>

    <h2 id="headers">
      .headers
    </h2>
  <p>Get the headers that were sent with the request:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.headers.answer).toBe(42);
};

// Test it
run(mid).get(&quot;/&quot;, { headers: { answer: 42 } });</code></pre>

    <h2 id="cookies">
      .cookies
    </h2>
  <p>Object that holds the cookies sent by the client:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  console.log(ctx.cookies);
};

run(mid).get(&quot;/&quot;);</code></pre>

    <h2 id="files">
      .files
    </h2>
  <p>Contains any and all of the files sent by a request. It would normally be sent through a form with an <code>&lt;input type=&quot;file&quot;&gt;</code> field or through a <a href="https://developer.mozilla.org/en-US/docs/Web/API/FormData"><code>FormData</code> in front-end javascript</a>:</p>
<pre><code class="language-html">&lt;form method=&quot;POST&quot; action=&quot;/profilepic&quot; enctype=&quot;multipart/form-data&quot;&gt;
  &lt;input name=&quot;profilepic&quot; type=&quot;input&quot; /&gt;
  &lt;input type=&quot;hidden&quot; name=&quot;_csrf&quot; value=&quot;{{_csrf}}&quot; /&gt;
  &lt;input type=&quot;submit&quot; value=&quot;Send picture&quot; /&gt;
&lt;/form&gt;</code></pre>
<p>Note the <a href="/documentation/router/#csrf-token">csrf token</a> and the <a href="https://stackoverflow.com/q/1342506/938236"><code>enctype=&quot;multipart/form-data&quot;</code></a>, both of them needed. Then to handle it with Node.js:</p>
<pre><code class="language-js">const mid = post(&quot;/profilepic&quot;, (ctx) =&gt; {
  // This comes from the &quot;name&quot; in the input field
  console.log(ctx.files.profilepic);
  return redirect(&quot;/profile&quot;);
});</code></pre>

    <h2 id="ip">
      .ip
    </h2>
  <p>The IP of the remote client. If it&#39;s behind a proxy that displays its proxy condition then the <code>ips</code> field will also be filled with the respective ips:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  console.log(ctx.ip, &quot;|&quot;, ctx.ips);
};

run(mid).get(&quot;/&quot;);</code></pre>

    <h2 id="url">
      .url
    </h2>
  <p>The full cuantified URL:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.url).toBe(&quot;/hello?answer=42&quot;);
};

run(mid).get(&quot;/hello?answer=42&quot;);</code></pre>

    <h2 id="method">
      .method
    </h2>
  <p>The request method, it can be <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.method).toBe(&quot;GET&quot;);
};

// Test it
run(mid).get(&quot;/&quot;);</code></pre>
<p>Or other methods:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.method).toBe(&quot;POST&quot;);
};

// Test it
run(noCsrf, mid).post(&quot;/&quot;);</code></pre>

    <h2 id="path">
      .path
    </h2>
  <p>Only the path part from the URL. It is the full URL except for the query:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.path).toBe(&quot;/question&quot;);
};

// Test it
run(mid).get(&quot;/question?answer=42&quot;);</code></pre>

    <h2 id="secure">
      .secure
    </h2>
  <p>Returns true if the request is made through HTTPS. Take into account that if you are behind Cloudflare or similar it might be reported as false even though your clients see <code>https</code>:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(ctx.secure).toBe(false);
};

// Test it
run(mid).get(&quot;/&quot;);</code></pre>

    <h2 id="xhr">
      .xhr
    </h2>
  <p>A boolean set to true if the request was done through AJAX. Specifically, if <code>X-Requested-With</code> is <code>“XMLHttpRequest”</code>:</p>
<pre><code class="language-js">const mid = (ctx) =&gt; {
  expect(mid.xhr).toBe(false);
};

run(mid).get(&quot;/&quot;);</code></pre>

          </article>
        </div>
      </div>
    </main>
    <script src="https://unpkg.com/prismjs@1.20.0/prism.js" charset="utf-8"></script>
    <script src="https://cdn.jsdelivr.net/npm/umbrellajs" charset="utf-8"></script>
    <script type="text/javascript">
      // Remove an incorrect "get" that there was highlighted
      Prism.hooks.add('after-highlight', function(env){
        u('span.token.keyword').each(el => {
          if (el.innerHTML === 'get') {
            if (el.nextElementSibling && el.nextElementSibling.innerHTML === '(') {
              u(el).replace('<span class="token function">get</span>');
            } else {
              u(el).replace('get');
            }
          }
          if (el.innerHTML === 'delete') {
            if (el.previousElementSibling && el.previousElementSibling.innerHTML === '.') {
              u(el).replace('delete');
            }
          }
          if (el.innerHTML === 'public') u(el).replace('public');
        });
      });
    </script>
  </body>
</html>
